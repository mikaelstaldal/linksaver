<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Saver</title>
    <link href="./static/missing.1.1.3.min.css" rel="stylesheet"
          integrity="sha384-qZFYlw2B1UM516YRx4hSbZ/hoB1pKQObWWpcVXira7ZSpjf5NkrwpJuSpuGuu2WS">
    <link href="./static/style.6.css" rel="stylesheet">
    <script src="./static/htmx.2.0.6.min.js"
            integrity="sha384-Akqfrbj/HpNVo8k11SXBb6TlBWmXXlYQrCSqEWmyKJe+hDm3Z/B2WVG4smwBkRVm"></script>
    <script src="./static/hyperscript.0.9.14.min.js"
            integrity="sha384-NzchC8z9HmP/Ed8cheGl9XuSrFSkDNHPiDl+ujbHE0F0I7tWC4rUnwPXP+7IvVZv"></script>
    <meta name="htmx-config" content='{"includeIndicatorStyles":false}'>
</head>
<body class="margin">
    <h1>Link Saver</h1>

    <div class="box bad" role="alert" id="error" hidden>
        <strong class="block titlebar">Error</strong>
        <p id="error-message"></p>
    </div>

    <div class="form-grid">
        <form hx-post="."
              hx-target="#links"
              hx-disabled-elt="find button"
              hx-push-url="true"
              _="
                  on htmx:afterRequest
                    if the event's detail.failed then
                      put the event's detail.xhr.responseText into #error-message
                      remove @hidden from #error
                    else
                      put '' into the value of #url
                      put '' into the value of #s
                      put '' into #error-message
                      add @hidden to #error
                    end
                  on dragenter
                    halt the event
                  on dragover
                    if the types of the event's dataTransfer contains 'text/uri-list'
                      halt the event
                    end
                  on drop
                    put the event's dataTransfer.getData('URL') into #url's value
                    requestSubmit() on me
                    halt the event
                ">
            <div class="f-col justify-content:center">
                <label for="url" class="text-nowrap">URL:</label>
            </div>
            <div>
                <input type="url" id="url" name="url" class="width:100%" required
                       placeholder="https://example.com">
            </div>
            <div class="f-col justify-content:center">
                <strong><button type="submit" class="big text-nowrap">Save Link</button></strong>
            </div>
        </form>
        <form hx-post="."
              hx-target="#links"
              hx-disabled-elt="find button"
              hx-push-url="true"
              _="
                  on htmx:afterRequest
                    if the event's detail.failed then
                      put the event's detail.xhr.responseText into #error-message
                      remove @hidden from #error
                    else
                      put '' into the value of #note-title
                      put '' into the value of #note-text
                      put '' into the value of #s
                      put '' into #error-message
                      add @hidden to #error
                    end
                ">
            <div class="f-col justify-content:center">
                <label for="note-title" class="text-nowrap">Title:</label>
            </div>
            <div>
                <input type="text" id="note-title" name="note-title" class="width:100%" maxlength="250" required
                          placeholder="Note title">
            </div>
            <div class="f-col justify-content:center" data-cols="1">
                <label for="note-text" class="text-nowrap">Text:</label>
            </div>
            <div>
                <textarea id="note-text" name="note-text" class="width:100%" maxlength="1020" rows="2" required
                          placeholder="Note text"></textarea>
            </div>
            <div class="f-col justify-content:center">
                <strong><button type="submit" class="big text-nowrap">Save Note</button></strong>
            </div>
        </form>
        <form hx-get="."
              hx-target="#links"
              hx-push-url="true">
            <div class="f-col justify-content:center">
                <label for="s" class="text-nowrap">Search:</label>
            </div>
            <div>
                <input type="text" id="s" name="s" class="width:100%" required>
            </div>
            <div class="f-col justify-content:center">
                <button type="submit" class="big text-nowrap">Search</button>
            </div>
        </form>
    </div>

    <p>Bookmarklet (drag to your bookmarks bar):
        <a id="bookmarklet-link" href="#">Save to Link Saver</a>
    </p>
    <script src="./static/bookmarklet.js"></script>

    <div id="links">
        {{template "links" .}}
    </div>
</body>
</html>
